<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ArkScript: Virtual Machine implementation details</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<link rel="search" href="../../search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="ArkScript"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../ArkTransparent-small.png"/></td>
  <td id="projectalign">
   <div id="projectname">ArkScript
   </div>
   <div id="projectbrief">A small, fast, functional and scripting language for video games</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,true,'search.php','Search');
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('db/d6c/md_impl_vm.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Virtual Machine implementation details </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="impl_vm"></a> </p>
<h2><a class="anchor" id="autotoc_md25"></a>
Constructing a VM</h2>
<p>This is done by calling the constructor of the VM, passing in a reference to an <code><a class="el" href="../../d1/d37/classArk_1_1State.html" title="Ark state to handle the dirty job of loading and compiling ArkScript code.">Ark::State</a></code>. It won't be modified, it was made this way to be able to share a single state between multiple independant virtual machines.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
Running the VM (and consequently running ArkScript bytecode)</h2>
<h3><a class="anchor" id="autotoc_md27"></a>
Initializing the VM</h3>
<p>The first step before running is to initialize the virtual machine state, this is done each time you call <code>VM::run</code> to reset its state (stack pointer, stack frame count, shared libs, locals, scopes) and reload the binded functions.</p>
<h3><a class="anchor" id="autotoc_md28"></a>
Running code while taking care of exceptions</h3>
<p>This is the next function called by <code>VM::run</code>: <code>VM::safeRun</code>. As its name suggests, it runs bytecode in a safe manner, taking care of the potential exceptions. This is by far the longest method (952 lines at the time writing). It will go through every instruction, running them sequentially, and if an exception is thrown, it will be caught, the exit code of the VM will be set to 1, and a backtrace will be displayed.</p>
<h3><a class="anchor" id="autotoc_md29"></a>
Backtrace generation</h3>
<p>This is done by <code>VM::backtrace</code> when an exception was thrown while the VM was running. It will display at most the last 7 elements in the call stack, with the function name (if any) and the arguments with their value. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Apr 23 2023 20:17:28 for ArkScript by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
